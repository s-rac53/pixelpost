{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>

        body {
            margin: 0;
            padding: 0;
        }
        .header {
            background: black;
            height: 100vh;
            width: 100%;

        }

        .header img {
            height: 70%;
            width: 70%;
            display: none;
        }

        #canvas1 {
            width: 70%;
            height: 70%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>

</head>
<body>
<div class="header">
    <img id="image" src = {% static 'PPP Logo.png' %} >
<canvas id="canvas1"></canvas>
</div>



<script>

   $(document).ready(function () {

         const img1 = '{% static 'face.jpg' %}';
         const img2 = '{% static 'anime2.png' %}';
         const img3 = '{% static 'anime3.png' %}';

        const canvas = document.getElementById('canvas1');
       const image1 = new Image();
       image1.src = img1;

      timer = setInterval(myTimer, 24700);


function myTimer() {

source = image1.getAttribute("src");
ctx.clearRect(0,0, canvas.width, canvas.height);
  if(source === img1) {
      image1.src = img2;

  }

   if(source === img2) {
      image1.src = img3;
  }

   if(source === img3) {
      image1.src = img1;

  }
}



    const ctx = canvas.getContext('2d');
image1.addEventListener('load', function () {
    canvas.width = image1.width;
    canvas.height = image1.height;
    ctx.drawImage(image1,0,0,canvas.width, canvas.height);
    const pixels = ctx.getImageData(0,0,canvas.width,canvas.height);
    ctx.clearRect(0,0,canvas.width, canvas.height);
    let particlesArray = [];
    const numberOfParticles = 8000;
    let mappedImage = [];
    for ( let y = 0; y < canvas.height; y++) {
        let row = [];
        for ( let x=0; x < canvas.width; x++) {
            const red = pixels.data[(y * 4 * pixels.width) + (x * 4)];
             const green = pixels.data[(y * 4 * pixels.width) + (x * 4 + 1)];
              const blue = pixels.data[(y * 4 * pixels.width) + (x * 4 + 2)];
              const brightness = calculateRelativeBrightness(red, green, blue);
              const cell = [
                  cellBrightness = brightness,
              ]
             row.push(cell);
        }
        mappedImage.push(row);
    }
    function  calculateRelativeBrightness(red, green, blue) {
        return Math.sqrt((red * red) * 0.299 +
            (green * green) * 0.587 +
            (blue * blue) * 0.114
        )/100;

    }
    class Particle {
        constructor () {
            this.x = Math.random() * canvas.width;
            this.y = 0;
            this.speed = 0;
            this.velocity = Math.random() * 1.5;
            this.size = Math.random() * 1.5 + 1;
            this.position1 = Math.floor(this.y);
            this.position2 = Math.floor(this.x);

            }

            update () {
                this.position1 = Math.floor(this.y);
                this.position2 = Math.floor(this.x);
                this.speed = mappedImage[this.position1][this.position2][0];
                let movement = ( 2.5 - this.speed) + this.velocity;
                this.y  += movement;
                if (this.y > canvas.height) {
                    this.y=0;
                    this.x = Math.random() * canvas.width;
                }
            }

            draw () {
                ctx.beginPath();
                ctx.fillStyle = 'white';
                ctx.arc(this.x,this.y,this.size,0,Math.PI * 2);
                ctx.fill();
            }
        }
     function  init() {
         for( let i = 0; i < numberOfParticles; i++) {
             particlesArray.push(new Particle);
         }
     }
     init();
 animate();




        function animate () {


             ctx.globalAlpha = 0.05;
            ctx.fillStyle = 'rgb(0,0,0)';
            ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.globalAlpha = 0.2;
            for(let i=0; i < particlesArray.length; i++) {
                 particlesArray[i].update();
                 ctx.globalAlpha = particlesArray[i].speed * 0.5;
                 particlesArray[i].draw();

            }


            myreq = requestAnimationFrame(animate);

           setTimeout(function(){
               cancelAnimationFrame(myreq);
               canvas.remove();
               image.style.display = "block";



    }, 60000);
          }


    });
    });

</script>
</body>
</html>